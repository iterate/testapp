<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="utf-8" />

        <title>Testapp</title>

        <style></style>
    </head>

    <body>
        <div id="messages"></div>
        <form action="#" id="sendform"><input id="message" /><button>Send</button></form>
    </body>

    <script>
        async function main() {
            let res = await fetch('/api/messages');
            if (!res.ok) {
                throw Error(`${res.status}: ${res.statusText}`);
            }
            let data = await res.json();

            let parent = document.getElementById('messages');
            data.forEach(({ text }) => {
                let div = document.createElement('div');
                div.innerText = text;
                parent.appendChild(div);
            });

            async function onSubmit(event) {
                event.preventDefault();
                let message = document.getElementById('message').value;
                let res = await fetch('/api/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message }),
                });
                if (!res.ok) {
                    throw Error(`${res.status}: ${res.statusText}`);
                }
            }

            document.getElementById('sendform').addEventListener('submit', (event) => {
                onSubmit(event).catch(console.error);
            });
        }

        main().catch(console.error);
    </script>
</html>
